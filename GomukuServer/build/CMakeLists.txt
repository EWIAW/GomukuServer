cmake_minimum_required(VERSION 3.10)
project(Gomuku LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 11)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# 项目根目录
get_filename_component(PROJECT_ROOT "${CMAKE_CURRENT_SOURCE_DIR}/.." ABSOLUTE)

# MyMuduo 源码目录
set(MYMUDUO_SRC_DIR "${PROJECT_ROOT}/MyMuduo")

# 数据库连接池 目录
set(MYSQLCONNECTIONPOOL_SRC_DIR "${PROJECT_ROOT}/MysqlConnectionPool")

# GameServer 源码目录
set(GAMESERVER_BASE_SRC_DIR "${PROJECT_ROOT}/GameServer/base")
set(GAMESERVER_DB_SRC_DIR "${PROJECT_ROOT}/GameServer/db")
set(GAMESERVER_MAIN_SRC_DIR "${PROJECT_ROOT}/GameServer/main")
set(GAMESERVER_MANAGER_SRC_DIR "${PROJECT_ROOT}/GameServer/manager")
set(GAMESERVER_MODEL_SRC_DIR "${PROJECT_ROOT}/GameServer/model")
set(GAMESERVER_MODULE_SRC_DIR "${PROJECT_ROOT}/GameServer/module")
set(GAMESERVER_NET_SRC_DIR "${PROJECT_ROOT}/GameServer/net")

# 收集所有源文件
file(GLOB MUDUO_SOURCES "${MYMUDUO_SRC_DIR}/*.cc")

file(GLOB MYSQLCONNECTIONPOOL_SOURCES "${MYSQLCONNECTIONPOOL_SRC_DIR}/*.cc")

file(GLOB GAMESERVER_BASE_SOURCES "${GAMESERVER_BASE_SRC_DIR}/*.cc")
file(GLOB GAMESERVER_DB_SOURCES "${GAMESERVER_DB_SRC_DIR}/*.cc")
file(GLOB GAMESERVER_MAIN_MANAGER_SOURCES "${GAMESERVER_MAIN_SRC_DIR}/*.cc")
file(GLOB GAMESERVER_MANAGER_SOURCES "${GAMESERVER_MANAGER_SRC_DIR}/*.cc")
file(GLOB GAMESERVER_MODEL_MANAGER_SOURCES "${GAMESERVER_MODEL_SRC_DIR}/*.cc")
file(GLOB GAMESERVER_MODULE_MANAGER_SOURCES "${GAMESERVER_MODULE_SRC_DIR}/*.cc")
file(GLOB GAMESERVER_NET_MANAGER_SOURCES "${GAMESERVER_NET_SRC_DIR}/*.cc")

# 合并所有源文件
set(ALL_SOURCES
    ${MUDUO_SOURCES}

    ${MYSQLCONNECTIONPOOL_SOURCES}

    ${GAMESERVER_BASE_SOURCES}
    ${GAMESERVER_DB_SOURCES}
    ${GAMESERVER_MAIN_MANAGER_SOURCES}
    ${GAMESERVER_MANAGER_SOURCES}
    ${GAMESERVER_MODEL_MANAGER_SOURCES}
    ${GAMESERVER_MODULE_MANAGER_SOURCES}
    ${GAMESERVER_NET_MANAGER_SOURCES}
)

# 添加可执行文件
add_executable(Gomuku ${ALL_SOURCES})

# include 目录
target_include_directories(Gomuku PRIVATE
    ${MUDUO_SRC_DIR}

    ${MYSQLCONNECTIONPOOL_SRC_DIR}

    ${GAMESERVER_BASE_SRC_DIR}
    ${GAMESERVER_DB_SRC_DIR}
    ${GAMESERVER_MAIN_SRC_DIR}
    ${GAMESERVER_MANAGER_SRC_DIR}
    ${GAMESERVER_MODEL_SRC_DIR}
    ${GAMESERVER_MODULE_SRC_DIR}
    ${GAMESERVER_NET_SRC_DIR}
    /usr/include/jsoncpp
    /usr/include/mysql
)

target_compile_options(Gomuku PRIVATE -Wall -Wextra)

# 线程库
find_package(Threads REQUIRED)

# 链接库
target_link_libraries(Gomuku PRIVATE
    Threads::Threads
    jsoncpp
    mysqlclient
)

# Debug 输出
message(STATUS "PROJECT_ROOT = ${PROJECT_ROOT}")
message(STATUS "MUDUO_SRC_DIR = ${MUDUO_SRC_DIR}")
message(STATUS "MYSQLCONNECTIONPOOL_SRC_DIR = ${MYSQLCONNECTIONPOOL_SRC_DIR}")
message(STATUS "GAMESERVER_BASE_SRC_DIR = ${GAMESERVER_BASE_SRC_DIR}")
message(STATUS "GAMESERVER_DB_SRC_DIR = ${GAMESERVER_DB_SRC_DIR}")
message(STATUS "GAMESERVER_MAIN_SRC_DIR = ${GAMESERVER_MAIN_SRC_DIR}")
message(STATUS "GAMESERVER_MANAGER_SRC_DIR = ${GAMESERVER_MANAGER_SRC_DIR}")
message(STATUS "GAMESERVER_MODEL_SRC_DIR = ${GAMESERVER_MODEL_SRC_DIR}")
message(STATUS "GAMESERVER_MODULE_SRC_DIR = ${GAMESERVER_MODULE_SRC_DIR}")
message(STATUS "GAMESERVER_NET_SRC_DIR = ${GAMESERVER_NET_SRC_DIR}")
message(STATUS "ALL_SOURCES = ${ALL_SOURCES}")